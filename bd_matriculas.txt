use master
go

create database matriculas_bd
go

use matriculas_bd
go

create table tb_rol
(
    id_rol int IDENTITY(1,1) primary key,
    nom_rol varchar(50) not null
)
go

INSERT INTO tb_rol (nom_rol) VALUES 
('Administrador'),
('Docente'),
('Alumno')
GO

create table tb_menu(
	id_menu int identity(1,1) primary key,
	titulo_menu varchar(50) not null,
	url_menu varchar(100),
	controlador varchar(100),
	orden smallint not null,
	es_activo bit default 1
)
go

INSERT INTO tb_menu (titulo_menu, url_menu, controlador,orden, es_activo) VALUES
('Listado de Cursos', 'listadoCursos', 'Curso',1, 1),
('Registrar Curso', 'registrarCurso', 'Curso', 2, 1),
('Listado de Docentes', 'listadoDocentes', 'Docente', 3, 1),
('Registrar Docente', 'registrarDocente', 'Docente', 4, 1),
('Listado Aulas', 'listadoAulas', 'Aula', 5, 1),
('Registrar Aulas', 'registrarAula', 'Aula', 6, 1),
('Inscribirse a Clases', 'inscribirse', 'Clase', 7, 1)
GO

create table tb_menu_rol(
	id_menu int not null,
	id_rol int not null,
	primary key (id_menu, id_rol),
	foreign key (id_menu) references tb_menu(id_menu),
	foreign key (id_rol) references tb_rol(id_rol)
 )
go
INSERT INTO tb_menu_rol (id_menu, id_rol)
SELECT id_menu, 1 FROM tb_menu
GO

INSERT INTO tb_menu_rol (id_menu, id_rol)
values (7,3)
GO

create table tb_especialidad
(
	cod_especialidad int IDENTITY(1,1) primary key,
	nom_especialidad varchar(50) not null
)
go

INSERT INTO tb_especialidad (nom_especialidad) VALUES
('Especialidad 1'),
('Especialidad 2'),
('Especialidad 3'),
('Especialidad 4'),
('Especialidad 5')
GO


create table tb_carrera
(
    id_carrera int IDENTITY(1,1) primary key,
    nom_carrera varchar(50) not null
)
go

INSERT INTO tb_carrera (nom_carrera) VALUES
('Carrera 1'),
('Carrera 2'),
('Carrera 3'),
('Carrera 4'),
('Carrera 5')
GO

create table tb_usuario
(
    id_usuario int IDENTITY(1,1) primary key,
	nom_usuario varchar(50) not null,
	ape_usuario varchar(50) not null,
	correo varchar(100) not null,
	contrasena varchar(30) null,
	cod_especialidad int null, --Docente
	id_carrera int null, --Alumno
	id_rol int not null, 
	estado bit not null,
	foreign key (id_rol) references tb_rol(id_rol),
	foreign key (cod_especialidad) references tb_especialidad(cod_especialidad),
	foreign key (id_carrera) references tb_carrera(id_carrera)
)
go

-- Crear usuarios Administradores
INSERT INTO tb_usuario (nom_usuario, ape_usuario, contrasena, correo, cod_especialidad, id_carrera, id_rol, estado)
VALUES 
('Admin', 'Principal', 'admin123', 'admin1@mail.com',NULL, NULL, 1, 1),
('Soporte', 'Técnico', 'soporte456', 'admin2@mail.com',NULL, NULL, 1, 1)
GO

-- Crear usuarios Docentes (asociados a especialidades)
INSERT INTO tb_usuario (nom_usuario, ape_usuario, contrasena, correo,cod_especialidad, id_carrera, id_rol, estado)
VALUES 
('Carlos', 'Mendoza', 'docente123', 'docente1@mail.com', 1, NULL, 2, 1),  
('Laura', 'García', 'docente456', 2, NULL, 2, 1),    
('Pedro', 'Martínez', 'docente789', 4, NULL, 2, 1)  
GO

-- Crear usuarios Alumnos (asociados a carreras)
INSERT INTO tb_usuario (nom_usuario, ape_usuario, contrasena, correo, cod_especialidad, id_carrera, id_rol, estado)
VALUES 
('Juan', 'Pérez', 'alumno123', 'alumno1@mail.com',NULL, 1, 3, 1), 
('María', 'López', 'alumno456', NULL, 2, 3, 1), 
('Ana', 'Gómez', 'alumno789', NULL, 1, 3, 1)    
GO

create table tb_curso
(
    id_curso int IDENTITY(1,1) primary key,
    nom_curso varchar(50) not null,
	creditos_curso smallint,
	id_carrera int,
	foreign key (id_carrera) references tb_carrera(id_carrera)
)
go

INSERT INTO tb_curso (nom_curso, creditos_curso, id_carrera) VALUES
('Programación I', 4, 1),
('Cálculo I', 4, 1),
('Introducción a la Administración', 3, 2),
('Derecho Civil', 5, 3)
GO

create table tb_aula
(
	id_aula int identity(1,1) primary key,
    cod_aula char(4) CHECK (cod_aula LIKE '[A-E][0-9][0-9][0-9]'),
    capacidad_aula smallint,
    es_disponible bit
)
go

INSERT INTO tb_aula (cod_aula, capacidad_aula, es_disponible) VALUES
('A101', 30, 1),
('B202', 25, 1),
('C303', 40, 1),
('D404', 20, 0)
GO


create table tb_seccion
(
	id_seccion int identity(1,1) primary key,
    cod_seccion char(4) CHECK (cod_seccion LIKE '[A-Z][0-9][A-Z][A-Z]'),
    cupos_disponible smallint,
    cupos_maximos smallint,
    horario_seccion char(5),
    id_usuario int,
    id_aula int,
	id_curso int,
    foreign key (id_usuario) references tb_usuario(id_usuario),
	foreign key (id_curso) references tb_curso(id_curso),
	foreign key (id_aula) references tb_aula(id_aula)
)
go

INSERT INTO tb_seccion (cod_seccion, cupos_disponible, cupos_maximos, horario_seccion, id_usuario, id_aula, id_curso) VALUES
('A1MA', 25, 30, '08:00', 3, 1, 1),  -- Docente Carlos Mendoza enseña Programación I
('B1TG', 20, 25, '10:00', 4, 2, 2)   -- Docente Laura García enseña Cálculo I
GO

create table tb_periodo
(
    id_periodo char(6) primary key CHECK (id_periodo LIKE '[2][0][2][0-9][-][1-2]'),
	fcha_inicio DateTime not null,
	fcha_fin DateTime not null,
)
go

create table tb_matricula
(
    id_matricula int IDENTITY(1000,1) primary key,
	id_usuario int,
	id_periodo char(6),
	foreign key (id_usuario) references tb_usuario(id_usuario),
	foreign key (id_periodo) references tb_periodo(id_periodo)
)
go

create table tb_detalle_matricula
(
    id_matricula int,
	id_seccion int,
	id_curso int,
	foreign key (id_matricula) references tb_matricula(id_matricula),
	foreign key (id_curso) references tb_curso(id_curso),
	foreign key (id_seccion) references tb_seccion(id_seccion)
)